<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/idangerous.swiper.css">
    <script src="js/idangerous.swiper.min.js"></script>
    <!-- 模板 -->
    <script src="./js/template-web.js"></script>
    <!-- 自己写的css样式 -->
    <link rel="stylesheet" href="./css/index.css">
    <!-- 自己写的js -->
    <script src="./js/index.js"></script>
</head>

<body>
    <!-- 1.布局容器 -->
    <!-- 导航栏 -->
    <div id="loading">
        <img src="./img/loading.gif" alt="">
    </div>
    <!-- 2.版心 -->
    <div class="main">
        <nav class="navbar navbar-inverse navbar-static-top navbar-default navbar-fixed-top" style="background-color: #636969;">
            <div class="container">
                <div class="navbar-header">
                    <!-- 定义切换按钮 -->
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mymenu">
                        <span class="sr-only">1</span>
                        <span class="icon-bar">1</span>
                        <span class="icon-bar">1</span>
                        <span class="icon-bar">1</span>
                    </button>
                    <!-- 定义网站logo -->
                </div>

                <div class="collapse navbar-collapse" id="mymenu">
                    <!--  定义导航条左侧的文字内容 -->
                    <ul class="nav navbar-nav">
                        <li><a class="navbar-brand" href="#">个人页面</a></li>
                        <li>
                            <button type="submit" class="music btn btn-default">听音乐</button>
                        </li>
                    </ul>

                    <!-- 定义导航条右侧的文字内容 -->
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#">天气情况:&nbsp;<span style="font-weight:700;">晴天</span></a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                aria-haspopup="true" aria-expanded="false">个人主题 <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">1</a></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#">4</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- <div class="container">
            <nav class="navbar navbar-default navbar-fixed-top nav">
                <div class="container">
                    <div class="container">
                        <div class="navbar-header">
                            <div class="navbar-header">
                                <a class="navbar-brand" href="#">个人页面</a>
                            </div>
                        </div>
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <form class="navbar-form navbar-left">
                                <button type="submit" class="music btn btn-default">听音乐</button>
                            </form>
                            <ul class="nav navbar-nav navbar-right">
                                <li><a href="#">天气情况:&nbsp;<span style="font-weight:700;">晴天</span></a></li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                        aria-haspopup="true" aria-expanded="false">个人主题 <span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">1</a></li>
                                        <li><a href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li><a href="#">4</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div> -->
        <!-- [3] -->
        <div class="container">
            <div class="container-fluid">
                <div class="row">
                    <div class="container text-center">
                        <div class="swiper-container ">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide blue-slide">我是第一张</div>
                                <div class="swiper-slide red-slide">我是第二张</div>
                                <div class="swiper-slide orange-slide">我是第三张</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section-title">
                    <h2>标签</h2>
                    <p>文本</p>
                </div>
                <div class="row">
                    <table class="table table-hover">
                    </table>
                </div>
                <!-- [3.1] -->
                <div class="row">
                    <!-- 3.2列 -->
                    <!-- 
                    lg : 只有设备宽度>=1200px ,  3才生效
                    md : 只有设备宽度>992px,  4才生效  
                    sm : 只有设备宽度>768px, 6才生效
                    <768, sm失效。 所有盒子独占一行-->
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594740651227&di=3e95aceb3a76c15bdbc8ce34f812255c&imgtype=0&src=http%3A%2F%2Fstatic.shenyou.cn%2Fuploadfile%2F2016%2F0920%2F20160920114524379.jpg%3Fwatermark%2F1%2Fimage%2FaHR0cDovL3N0YXRpYy5zaGVueW91LnR2L3dhdGVyX21hcmsucG5n%2Fdissolve%2F100%2Fgravity%2FSouthEast%2F"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594740651224&di=a3d6c4e068c6ab341c141a083f48e315&imgtype=0&src=http%3A%2F%2Fi1.hdslb.com%2Fbfs%2Farchive%2F74767b9f8a718f4c05fb2bfd00bc1ca7d573efbf.jpg"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6 ">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594740971061&di=ed78b00a8a2b5c1a07238f52988e8be5&imgtype=0&src=http%3A%2F%2Fimgsrc.baidu.com%2Fforum%2Fw%3D580%2Fsign%3D7eafe8bbf1039245a1b5e107b795a4a8%2F989fc254564e92586c6898989182d158cdbf4ea0.jpg"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594740971061&di=ed78b00a8a2b5c1a07238f52988e8be5&imgtype=0&src=http%3A%2F%2Fimgsrc.baidu.com%2Fforum%2Fw%3D580%2Fsign%3D7eafe8bbf1039245a1b5e107b795a4a8%2F989fc254564e92586c6898989182d158cdbf4ea0.jpg"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594741476036&di=312faed07145a6b4c72c7092789c41f1&imgtype=0&src=http%3A%2F%2Fvpic.video.qq.com%2F3388556%2Fe0545gnthu8_ori_3.jpg"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594741476036&di=0dcfc6029acb343177679c65b84f0f2e&imgtype=0&src=http%3A%2F%2Fi8.17173.itc.cn%2Fv3%2Foutcms%2F2014%2F03%2F27%2F1395854667814_image_9406.jpg"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594741476036&di=0dcfc6029acb343177679c65b84f0f2e&imgtype=0&src=http%3A%2F%2Fi8.17173.itc.cn%2Fv3%2Foutcms%2F2014%2F03%2F27%2F1395854667814_image_9406.jpg"
                                alt="">
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="inner">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1594741476036&di=0dcfc6029acb343177679c65b84f0f2e&imgtype=0&src=http%3A%2F%2Fi8.17173.itc.cn%2Fv3%2Foutcms%2F2014%2F03%2F27%2F1395854667814_image_9406.jpg"
                                alt="">
                        </div>
                    </div>
                </div>
            </div>
            <!-- [3.2] -->

            <!-- 2.行 -->
            <!--  -->
            <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">1</div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">2</div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">3</div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">4</div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">1</div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">2</div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">3</div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="box">4</div>
                </div>
            </div>
        </div>
    </div>
    <!-- [4]音乐模块 -->
    <div class="current">
        <div class="top">
            <h1>音乐</h1>
            <input type="search" class="search" placeholder="请输入音乐后按回车查询">
        </div>
        <span class="x">x</span>
        <div class="middle">
            <div class="music_name">
                <ul>
                    <li>Welcome to Mymusic</li>
                </ul>
            </div>
            <div class="music_text">
                <div class="warp">
                    <h2>Welcome to Mymusic</h2>
                </div>
            </div>
        </div>
        <div class="bottom">
            <audio controls src="" id="play"></audio>
        </div>
    </div>
    <script id="musicName" type="text/html">
            {{each result.songs v i}}
            <li id="{{ v.id }}">{{ v.name }} <span>-{{ v.artists[0].name }}</span></li>
            {{/each}}
        </script>
    <script id="musicText" type="text/html">
            <h2>{{ b }}</h2>
            {{ each a v}}
            <p> {{ v }}</p>
            {{ /each }}
        </script>
    <script>
        // 入口函数
        $(function () {
            /*  搜索音乐模块
            1.分析需求(交互)：
            1.1 输入框按下回车键 将接口返回的数据放在歌单中
            1.2 点击歌单列表，将li里面的文本传给接口，返回的数据给下面的播放控件播放
                边上的歌词显示
                注重点：1.歌单列表是后面添加的元素，交互事件需要事件委托
                        2.返回的歌词如何变成一段一段的p标签
            */

            // 1.1 输入框按下回车键 将接口返回的数据放在歌单中
            $('.search').on('keydown', function (e) {
                if (e.keyCode == 13) {
                    var keywords = $(this).val();
                    $(this).val('');
                    // 发送请求
                    $.ajax({
                        url: 'https://autumnfish.cn/search',
                        type: 'get',
                        dataType: 'json',
                        data: {
                            keywords: keywords
                        },
                        success: function (backData) {
                            // 渲染
                            $('.music_name ul').empty();
                            $('.music_name ul').append(template('musicName', backData));
                        }
                    });
                };
            });
            // 1.2 点击歌单列表，将li里面的文本传给接口，返回的数据给下面的播放控件播放
            $('body').on('click', '.music_name ul li', function () {
                var index = $(this).index();
                var id = $(this).attr('id');
                var name = $(this).text();
                // 获取歌词
                // 发送请求
                $.ajax({
                    url: 'https://autumnfish.cn/lyric',
                    type: 'get',
                    dataType: 'json',
                    data: {
                        id: id
                    },
                    success: function (backData) {
                        $('.warp').empty();
                        var reg = /\[.+\]/g;
                        var str = backData.lrc.lyric.replace(reg, '')
                        var arr = str.split('\n');
                        $('.warp').append(template('musicText', {
                            a: arr,
                            b: name
                        }))
                    }
                });
                // 播放音乐
                // 发送请求
                $.ajax({
                    url: 'https://autumnfish.cn/song/url',
                    type: 'get',
                    dataType: 'json',
                    data: {
                        id: id
                    },
                    success: function (backData) {
                        console.log(backData.data[0].url);
                        $('#play').attr('src', backData.data[0].url);
                        $('#play')[0].play();
                        setTimeout(function () {
                            var playTime = Math.ceil($('#play')[0].duration);
                            $('.warp').stop(true, false).animate({
                                top: '-200%'
                            }, playTime * 500, function () {
                                $('.warp').css('top', '40%')
                            })

                        }, 200);
                        $('#play')[0].onended = function () {
                            if (index == ($('body .music_name ul li')).length) {
                                return
                            }
                            // 当前播放完之后继续播放下一首
                            $('body .music_name ul li').eq(index + 1).click();
                        };
                    }
                });
            });
        });
    </script>
</body>

</html>